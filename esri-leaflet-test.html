<html>

<head>
    <meta charset=utf-8 />
    <title>Esri-Leaflet Test</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <!-- Load Leaflet from CDN-->
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.js'></script>

    <!-- Load Esri Leaflet from CDN -->
    <script src="http://cdn.jsdelivr.net/leaflet.esri/1.0.0/esri-leaflet.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            left: 0;
        }
    </style>
</head>

<body>

    <div id="map"></div>

    <script>
        var map = L.map('map').setView([37.8, -96], 5);

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6IjZjNmRjNzk3ZmE2MTcwOTEwMGY0MzU3YjUzOWFmNWZhIn0.Y8bhBaUMqFiPrDRW9hieoQ', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            id: 'mapbox.light'
        }).addTo(map);

        //divisions - these are so slow bc geojson
        var divisions = L.esri.featureLayer({
            url: 'http://services.arcgis.com/pGfbNJoYypmNq86F/arcgis/rest/services/2015_ARC_Division_Boundaries/FeatureServer/0',
            simplifyFactor: 0.5,
            precision: 5,
            style: function (feature) {
                return {
                    color: "#000",
                    weight: 3,
                    fill: null
                };
            }
        }).addTo(map);

        //regions
        var regions = L.esri.featureLayer({
            url: 'http://services.arcgis.com/pGfbNJoYypmNq86F/arcgis/rest/services/2015_ARC_Region_Boundaries/FeatureServer/0',
            simplifyFactor: 0.5,
            precision: 5,
            style: function (feature) {
                return {
                    color: 'red',
                    weight: 2,
                    fill: null
                };
            }
        }).addTo(map);

        //chapters
        var chapters = L.esri.featureLayer({
            url: 'http://services.arcgis.com/pGfbNJoYypmNq86F/arcgis/rest/services/2015_ARC_Chapter_Boundaries/FeatureServer/0',
            simplifyFactor: 0.5,
            precision: 5,
            style: function (feature) {
                return {
                    color: 'blue',
                    weight: 1,
                    fill: 'blue',
                    fillOpacity: 0
                };
            }
        }).addTo(map);

        chapters.bindPopup(function (feature) {
            return L.Util.template('<p><b>{CHAPTER}</b><br>{REGIONS}<br>{DIVISION}</p>', feature.properties);
        });

        var markerOptions = {
            radius: 2,
            fillColor: "green",
            color: "#green",
            weight: 1,
            opacity: 0.5,
            fillOpacity: 0.5
        };

        //HFPC home visits - ESRI won't show above a certain (small) number - this really needs to be tiled
        var hfpc = L.esri.featureLayer({
            url: 'http://services.arcgis.com/pGfbNJoYypmNq86F/arcgis/rest/services/HFPC_Activity/FeatureServer/0',
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, markerOptions);
            }
        }).addTo(map);
    </script>

</body>

</html>